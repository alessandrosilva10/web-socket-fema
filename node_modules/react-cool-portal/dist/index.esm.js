import{useRef,useEffect,useState,useCallback}from"react";import{createPortal as createPortal$1}from"react-dom";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var u,i=e[Symbol.iterator]();!(n=(u=i.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return r}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var useLatest=function(e){var t=useRef(e);return useEffect((function(){t.current=e}),[e]),t},delay=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=setTimeout((function(){clearTimeout(r),e()}),t)},createEl=function(e){var t=document.createElement("div");return t.setAttribute("id",e),document.body.appendChild(t),t},createPortal=function(e,t,r,n){return function(o){var a=o.children,u=_slicedToArray(useState(null),2),i=u[0],c=u[1];return useEffect((function(){return t?(c(document.getElementById(e)||createEl(e)),function(){i&&delay((function(){""===i.innerHTML&&i.remove()}))}):function(){return null}}),[i]),useEffect((function(){if(!t||!i)return function(){return null};var e=function(e){i.contains(e.target)||r(e)},o=function(e){27===e.keyCode&&n(e)};return r&&document.addEventListener("click",e),n&&document.addEventListener("keydown",o),function(){r&&document.removeEventListener("click",e),n&&document.removeEventListener("keydown",o)}}),[i]),t&&i&&createPortal$1(a,i)}},defaultContainerId="react-cool-portal",initShow=!0,usePortal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.containerId,r=void 0===t?defaultContainerId:t,n=e.defaultShow,o=void 0===n?initShow:n,a=e.clickOutsideToHide,u=void 0===a||a,i=e.escToHide,c=void 0===i||i,l=e.internalShowHide,d=void 0===l||l,f=e.onShow,s=e.onHide,y=useState(o),m=_slicedToArray(y,2),v=m[0],b=m[1],h=useRef(!1),p=useLatest(f),A=useLatest(s),k=useRef(o),S=useCallback((function(){u&&(h.current=!0,delay((function(){h.current=!1})))}),[u]),T=useCallback((function(e){S(),k.current||(b(!0),k.current=!0,p.current&&p.current(e))}),[S]),w=useCallback((function(e){S(),k.current&&(b(!1),k.current=!1,A.current&&A.current(e))}),[S]),_=useCallback((function(e){k.current?w(e):T(e)}),[w,T]),C=useCallback((function(e){h.current||w(e)}),[w]),E=useCallback(createPortal(r,!d||v,u&&C,c&&C),[d&&v]);return{Portal:E,isShow:v,show:T,hide:w,toggle:_}};export default usePortal;export{defaultContainerId,initShow};
