{"ast":null,"code":"import _regeneratorRuntime from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/alessandro/Desktop/backend_almir/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/*!\n\n=========================================================\n* Argon Dashboard React - v1.1.0\n=========================================================\n\n* Product Page: https://www.creative-tim.com/product/argon-dashboard-react\n* Copyright 2019 Creative Tim (https://www.creative-tim.com)\n* Licensed under MIT (https://github.com/creativetimofficial/argon-dashboard-react/blob/master/LICENSE.md)\n\n* Coded by Creative Tim\n\n=========================================================\n\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n*/import React from\"react\";// javascipt plugin for creating charts\nimport Chart from\"chart.js\";import{withCookies}from\"react-cookie\";import{toast,ToastContainer}from'react-toastify';import'react-toastify/dist/ReactToastify.min.css';import ListNotes from'./ListNotes';//import { fetchNotes, fetchNote, updateNote } from '../../src/api';\nimport AddNoteForm from\"./AddNoteForm\";import EditNoteForm from\"./EditNoteForm\";import Websocket from'react-websocket';// reactstrap components\nimport{Container,Row,Col,Button}from\"reactstrap\";// core components\nimport{chartOptions,parseOptions}from\"variables/charts.js\";import Header from\"components/Headers/Header.js\";var Index=/*#__PURE__*/function(_React$Component){_inherits(Index,_React$Component);var _super=_createSuper(Index);function Index(props){var _this;_classCallCheck(this,Index);_this=_super.call(this,props);_this.sucess=function(){return toast.success(\"Usuário logado com sucesso!\");};_this.warning=function(){return toast.warning(\"Usuário não autenticado!\");};_this.toggleNavs=function(e,index){e.preventDefault();_this.setState({activeNav:index,chartExample1Data:_this.state.chartExample1Data===\"data1\"?\"data2\":\"data1\"});};_this.url='http://127.0.0.1:8000/api/v1/notes/';_this.fetchNotes=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:fetch(_this.url,{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json','Authorization':\"Token \".concat(_this.props.cookies.get('token'))}}).then(function(res){return res.json();}).then(function(data){return data;});case 1:case\"end\":return _context.stop();}}},_callee);}));_this.fetchNote=function(id){return fetch(\"\".concat(_this.url+id),{headers:{'Authorization':\"Token \".concat(_this.props.cookies.get('token'))}}).then(function(res){return res.json();}).then(function(data){return data;});};_this.addNote=function(note){fetch(_this.url,{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json','Authorization':\"Token \".concat(_this.props.cookies.get('token'))},body:JSON.stringify(note)}).then(function(res){return res.json();}).then(function(data){console.log(data);});return note;};_this.state={activeNav:1,chartExample1Data:\"data1\",notes:[],note:{},current_note_id:0,is_creating:true};_this.handleItemClick=_this.handleItemClick.bind(_assertThisInitialized(_this));_this.handleAddItem=_this.handleAddItem.bind(_assertThisInitialized(_this));_this.addNote=_this.addNote.bind(_assertThisInitialized(_this));_this.getData=_this.getData.bind(_assertThisInitialized(_this));_this.handleSaveNote=_this.handleSaveNote.bind(_assertThisInitialized(_this));_this.fetchNotes=_this.fetchNotes.bind(_assertThisInitialized(_this));_this.handleOnChange=_this.handleOnChange.bind(_assertThisInitialized(_this));if(window.Chart){parseOptions(Chart,chartOptions());}return _this;}_createClass(Index,[{key:\"getData\",value:function(){var _getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this2=this;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:fetch(this.url,{method:'GET',headers:{'Authorization':\"Token \".concat(this.props.cookies.get('token'))}}).then(function(resp){return resp.json();}).then(function(res){return _this2.setState({notes:res},function(){console.log(this.state.notes);console.log(this.props.cookies.get('token'));});}).catch(function(error){return console.log(error);});case 1:case\"end\":return _context2.stop();}}},_callee2,this);}));function getData(){return _getData.apply(this,arguments);}return getData;}()},{key:\"handleItemClick\",value:function(){var _handleItemClick=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id){var selected_note;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.fetchNote(id);case 2:selected_note=_context3.sent;this.setState(function(prevState){return{is_creating:false,current_note_id:id,note:selected_note};});case 4:case\"end\":return _context3.stop();}}},_callee3,this);}));function handleItemClick(_x){return _handleItemClick.apply(this,arguments);}return handleItemClick;}()},{key:\"handleAddItem\",value:function handleAddItem(){this.setState(function(prevState){return{is_creating:true};});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this3=this;this.sucess();fetch('http://127.0.0.1:8000/api/v1/notes/',{method:'GET',headers:{'Authorization':\"Token \".concat(this.props.cookies.get('token'))}}).then(function(resp){return resp.json();}).then(function(res){return _this3.setState({notes:res},function(){console.log(this.state.notes);console.log(this.props.cookies.get('token'));});}).catch(function(error){return console.log(error);});}},{key:\"handleSaveNote\",value:function(){var _handleSaveNote=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(data){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.addNote(data);case 2:_context4.next=4;return this.getData();case 4:case\"end\":return _context4.stop();}}},_callee4,this);}));function handleSaveNote(_x2){return _handleSaveNote.apply(this,arguments);}return handleSaveNote;}()},{key:\"handleData\",value:function handleData(data){var result=JSON.parse(data);var current_note=this.state.note;if(this.state.current_note_id==result.id){this.setState({note:result});}}},{key:\"handleOnChange\",value:function handleOnChange(e){var content=e.target.value;var current_note=this.state.note;current_note.content=content;this.setState({note:current_note});var socket=this.refs.socket;socket.state.ws.send(JSON.stringify(current_note));}},{key:\"render\",value:function render(){var _this4=this;var token=this.props.cookies.get('token');if(token===null||token===\"undefined\"){return window.location.replace('/auth/login');}else{return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(Container,{className:\"mt--7\",fluid:true},/*#__PURE__*/React.createElement(Col,{xs:\"2\"},/*#__PURE__*/React.createElement(Button,{color:\"primary\",onClick:this.handleAddItem},\"Criar um novo\")),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{xs:\"4\"},/*#__PURE__*/React.createElement(ListNotes,{notes:this.state.notes,handleItemClick:function handleItemClick(id){return _this4.handleItemClick(id);}})),/*#__PURE__*/React.createElement(Col,{xs:\"8\"},this.state.is_creating?/*#__PURE__*/React.createElement(AddNoteForm,{handleSave:this.handleSaveNote}):/*#__PURE__*/React.createElement(EditNoteForm,{handleChange:this.handleOnChange,note:this.state.note}),/*#__PURE__*/React.createElement(Websocket,{ref:\"socket\",url:\"ws://localhost:8000/ws/notes\",onMessage:this.handleData.bind(this)}))),/*#__PURE__*/React.createElement(Row,{className:\"mt-5\"},/*#__PURE__*/React.createElement(ToastContainer,null))));}}}]);return Index;}(React.Component);export default withCookies(Index);","map":{"version":3,"sources":["/home/alessandro/Desktop/backend_almir/frontend/src/views/Index.js"],"names":["React","Chart","withCookies","toast","ToastContainer","ListNotes","AddNoteForm","EditNoteForm","Websocket","Container","Row","Col","Button","chartOptions","parseOptions","Header","Index","props","sucess","success","warning","toggleNavs","e","index","preventDefault","setState","activeNav","chartExample1Data","state","url","fetchNotes","fetch","method","headers","Accept","cookies","get","then","res","json","data","fetchNote","id","addNote","note","body","JSON","stringify","console","log","notes","current_note_id","is_creating","handleItemClick","bind","handleAddItem","getData","handleSaveNote","handleOnChange","window","resp","catch","error","selected_note","prevState","result","parse","current_note","content","target","value","socket","refs","ws","send","token","location","replace","handleData","Component"],"mappings":"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","sourcesContent":["/*!\n\n=========================================================\n* Argon Dashboard React - v1.1.0\n=========================================================\n\n* Product Page: https://www.creative-tim.com/product/argon-dashboard-react\n* Copyright 2019 Creative Tim (https://www.creative-tim.com)\n* Licensed under MIT (https://github.com/creativetimofficial/argon-dashboard-react/blob/master/LICENSE.md)\n\n* Coded by Creative Tim\n\n=========================================================\n\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n*/\nimport React from \"react\";\n// javascipt plugin for creating charts\nimport Chart from \"chart.js\";\nimport { withCookies } from \"react-cookie\";\nimport { toast, ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.min.css';\nimport ListNotes from './ListNotes';\n//import { fetchNotes, fetchNote, updateNote } from '../../src/api';\nimport AddNoteForm from \"./AddNoteForm\";\nimport EditNoteForm from \"./EditNoteForm\";\nimport Websocket from 'react-websocket';\n// reactstrap components\nimport {\n  Container,\n  Row,\n  Col,\n  Button\n} from \"reactstrap\";\n\n// core components\nimport {\n  chartOptions,\n  parseOptions,\n} from \"variables/charts.js\";\n\nimport Header from \"components/Headers/Header.js\";\n\nclass Index extends React.Component {\n   sucess = () => toast.success(\"Usuário logado com sucesso!\");\n   warning = () => toast.warning(\"Usuário não autenticado!\");\n\n  constructor(props){\n    super(props);\n\n    this.state = {\n      activeNav: 1,\n      chartExample1Data: \"data1\",\n      notes: [],\n      note: {},\n      current_note_id: 0,\n      is_creating: true\n    };\n\n    this.handleItemClick = this.handleItemClick.bind(this);\n    this.handleAddItem = this.handleAddItem.bind(this);\n    this.addNote = this.addNote.bind(this);\n    this.getData = this.getData.bind(this);\n    this.handleSaveNote = this.handleSaveNote.bind(this);\n    this.fetchNotes = this.fetchNotes.bind(this);\n    this.handleOnChange = this.handleOnChange.bind(this)\n\n    if (window.Chart) {\n      parseOptions(Chart, chartOptions());\n    }\n  }\n\n  toggleNavs = (e, index) => {\n    e.preventDefault();\n    this.setState({\n      activeNav: index,\n      chartExample1Data:\n        this.state.chartExample1Data === \"data1\" ? \"data2\" : \"data1\"\n    });\n  };\n\n   async getData(){\n     fetch(this.url, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Token ${this.props.cookies.get('token')}`\n        }\n      }).then( resp => resp.json()).then( res => this.setState({notes: res}, function() {\n            console.log(this.state.notes)\n            console.log(this.props.cookies.get('token'))\n      }))\n      .catch(error => console.log(error))\n\n    }\n\n  async handleItemClick(id) {\n    let selected_note = await this.fetchNote(id);\n\n    this.setState((prevState) => {\n      return {\n        is_creating: false,\n        current_note_id: id,\n        note: selected_note\n      }\n    })\n  }\n\n    handleAddItem(){\n        this.setState((prevState) => {\n            return{is_creating: true}\n        })\n    }\n\n  componentDidMount(){\n       this.sucess()\n        fetch('http://127.0.0.1:8000/api/v1/notes/', {\n        method: 'GET',\n        headers: {\n          'Authorization': `Token ${this.props.cookies.get('token')}`\n        }\n      }).then( resp => resp.json()).then( res => this.setState({notes: res}, function() {\n            console.log(this.state.notes)\n            console.log(this.props.cookies.get('token'))\n      }))\n      .catch(error => console.log(error))\n    }\n\n    url = 'http://127.0.0.1:8000/api/v1/notes/';\n\n    fetchNotes = async () => {\n        fetch(this.url, {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n           'Authorization': `Token ${this.props.cookies.get('token')}`\n        }\n      })\n      .then(res => res.json())\n      .then(data => {\n            return(data);\n      })\n    }\n\n  fetchNote = (id) => {\n  return fetch(`${this.url + id}`, {headers: {\n           'Authorization': `Token ${this.props.cookies.get('token')}`\n        }})\n    .then(res => res.json())\n    .then(data => {\n      return data;\n    });\n}\n\n    addNote = (note) => {\n      fetch(this.url, {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n          'Authorization': `Token ${this.props.cookies.get('token')}`\n        },\n        body: JSON.stringify(note)\n      })\n      .then(res => res.json())\n      .then(data => {\n        console.log(data);\n      })\n\n      return note;\n    }\n\n    async handleSaveNote(data){\n        await this.addNote(data);\n        await this.getData();\n    }\n\n    handleData(data){\n\n        let result = JSON.parse(data);\n        let current_note = this.state.note;\n\n        if(this.state.current_note_id == result.id){\n            this.setState({note: result})\n        }\n    }\n\n handleOnChange(e) {\n    let content = e.target.value;\n    let current_note = this.state.note;\n    current_note.content = content;\n\n    this.setState({\n      note: current_note\n    });\n\n    const socket = this.refs.socket;\n    socket.state.ws.send(JSON.stringify(current_note));\n  }\n\n    render() {\n        let token = this.props.cookies.get('token')\n        if(token === null || token === \"undefined\"){\n        return (\n            window.location.replace('/auth/login')\n        )\n        }else{\n          return (\n          <>\n            <Header />\n            <Container className=\"mt--7\" fluid>\n                 <Col xs=\"2\">\n                        <Button color=\"primary\" onClick={this.handleAddItem}>Criar um novo</Button>\n                    </Col>\n                    <Row>\n                        <Col xs=\"4\">\n                            <ListNotes notes={this.state.notes} handleItemClick={(id) => this.handleItemClick(id)} />\n                        </Col>\n                         <Col xs=\"8\">\n                              {\n                                this.state.is_creating ?\n                                <AddNoteForm handleSave={this.handleSaveNote}/> :\n                                <EditNoteForm handleChange={this.handleOnChange} note={this.state.note}/>\n                              }\n                              <Websocket ref=\"socket\" url='ws://localhost:8000/ws/notes'\n                              onMessage={this.handleData.bind(this)}/>\n                         </Col>\n                    </Row>\n              <Row className=\"mt-5\">\n                  <ToastContainer />\n              </Row>\n            </Container>\n          </>\n        );\n        }\n    }\n  }\n\nexport default withCookies(Index);\n"]},"metadata":{},"sourceType":"module"}